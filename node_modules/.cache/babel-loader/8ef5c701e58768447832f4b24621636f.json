{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/FacebookClient/src/pages/conversation/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { HomeOutlined } from '@ant-design/icons';\nimport { Button, Col, message, Modal, Row, Tooltip } from 'antd';\nimport { push } from 'connected-react-router';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getPackagesActive } from '../../api/billing-api';\nimport { validateToken } from '../../api/fanpage';\nimport { LoginFacebookBtn } from '../../components';\nimport ExpiredStore from '../../components/expired-store';\nimport constants from '../../constants';\nimport { CustomerLayout } from '../../layout';\nimport { loginActionWithService } from '../../reducers/authState/authAction';\nimport { checkRestrictAction } from '../../utils/get-time';\nimport { useNotification } from '../customer/notfication-context';\nimport ConversationCustomer from './conversation-customer';\nimport ConversationDetail from './conversation-detail';\nimport CoversationList from './conversation-list';\nimport './style.less';\nimport TabPages from './tab-pages';\nimport useHiddenModalExpired from '../../hooks/use-hidden-modal-expired';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Conversation = () => {\n  _s();\n\n  const {\n    title\n  } = useNotification();\n  const dispatch = useDispatch();\n  const page = useSelector(({\n    fanpage\n  }) => fanpage.page);\n  const loading = useSelector(({\n    fanpage\n  }) => fanpage.loading);\n  const store = useSelector(({\n    store\n  }) => store.store);\n  const loadingStore = useSelector(({\n    store\n  }) => store.loading);\n  const token = useSelector(({\n    auth\n  }) => auth.token);\n  const loadingAuth = useSelector(({\n    auth\n  }) => auth.loading);\n  const [isValidToken, setIsValidToken] = useState(true);\n  const [visible, setVisible] = useState(false);\n  const {\n    hiddenModalExpired,\n    setValueHidden\n  } = useHiddenModalExpired();\n\n  const handleCancelPopup = () => {\n    setVisible(false);\n    dispatch(push('/customer/conversation'));\n    setValueHidden('true');\n  };\n\n  const handleBuyPackage = () => {\n    window.open(`${constants.URL_STORE}setting/billings/list`, '_blank');\n  };\n\n  const getPackages = async () => {\n    const packages = await getPackagesActive(store._id);\n    const pkgsActive = packages.filter(item => item.active);\n    setVisible(checkRestrictAction(pkgsActive));\n  };\n\n  const handleSocialLogin = (response, service) => {\n    const {\n      accessToken\n    } = response;\n\n    if (accessToken) {\n      dispatch(loginActionWithService({\n        accessToken\n      }, service));\n    } else {\n      message.error('Đăng nhập không thành công.');\n    }\n  };\n\n  const loginFacebook = data => {\n    handleSocialLogin(data, 'facebook');\n  };\n\n  const title_page = `${title} Conversation`;\n  useEffect(() => {\n    if (!loading && !loadingAuth && !loadingStore && page) {\n      const callApiCheckToken = async () => {\n        try {\n          await validateToken({\n            storeId: store._id,\n            fbPageId: page.fbObjectId,\n            token: token.accessToken\n          });\n          setIsValidToken(true);\n        } catch (error) {\n          setIsValidToken(false);\n        }\n      };\n\n      callApiCheckToken();\n    }\n\n    getPackages();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [!hiddenModalExpired && /*#__PURE__*/_jsxDEV(ExpiredStore, {\n      visible: visible,\n      onCancel: handleCancelPopup,\n      onBuyPackage: handleBuyPackage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(CustomerLayout, {\n      title: title_page,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"conversation\",\n        children: [/*#__PURE__*/_jsxDEV(TabPages, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"conversation-main\",\n          children: /*#__PURE__*/_jsxDEV(Row, {\n            className: \"content\",\n            children: [/*#__PURE__*/_jsxDEV(Col, {\n              style: {\n                width: 350\n              },\n              className: \"column conversation-wrap\",\n              children: /*#__PURE__*/_jsxDEV(CoversationList, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 105,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              className: \"column\",\n              style: {\n                flex: 1,\n                overflow: 'hidden'\n              },\n              children: /*#__PURE__*/_jsxDEV(ConversationDetail, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 108,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 107,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              style: {\n                maxWidth: 400,\n                width: '33.33%'\n              },\n              className: \"column\",\n              children: /*#__PURE__*/_jsxDEV(ConversationCustomer, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }, this), !loading && !isValidToken ? /*#__PURE__*/_jsxDEV(Modal, {\n        visible: true,\n        footer: null,\n        closeIcon: null,\n        closable: false,\n        bodyStyle: {\n          padding: 10,\n          textAlign: 'center'\n        },\n        width: 400,\n        title: /*#__PURE__*/_jsxDEV(Row, {\n          align: \"middle\",\n          justify: \"space-between\",\n          children: [/*#__PURE__*/_jsxDEV(Col, {\n            children: \"Th\\xF4ng b\\xE1o\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            children: /*#__PURE__*/_jsxDEV(Tooltip, {\n              placement: \"left\",\n              title: \"Trang ch\\u1EE7\",\n              color: \"blue\",\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                icon: /*#__PURE__*/_jsxDEV(HomeOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 130,\n                  columnNumber: 51\n                }, this),\n                onClick: () => dispatch(push('/'))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 129,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 29\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginBottom: 10\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Facebook token c\\u1EE7a b\\u1EA1n \\u0111\\xE3 h\\u1EBFt h\\u1EA1n ho\\u1EB7c \\u0111\\xE3 b\\u1ECB thay \\u0111\\u1ED5i.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Vui l\\xF2ng k\\u1EBFt n\\u1ED1i l\\u1EA1i t\\xE0i kho\\u1EA3n facebook c\\u1EE7a b\\u1EA1n.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(LoginFacebookBtn, {\n          loginFacebook: loginFacebook,\n          title: \" K\\u1EBFt n\\u1ED1i l\\u1EA1i v\\u1EDBi facebook\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Conversation, \"qesoHPoOkWc9GQRhtfrCXOiLurk=\", false, function () {\n  return [useNotification, useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useHiddenModalExpired];\n});\n\n_c = Conversation;\nexport default Conversation;\n\nvar _c;\n\n$RefreshReg$(_c, \"Conversation\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/FacebookClient/src/pages/conversation/index.tsx"],"names":["HomeOutlined","Button","Col","message","Modal","Row","Tooltip","push","React","useEffect","useState","useDispatch","useSelector","getPackagesActive","validateToken","LoginFacebookBtn","ExpiredStore","constants","CustomerLayout","loginActionWithService","checkRestrictAction","useNotification","ConversationCustomer","ConversationDetail","CoversationList","TabPages","useHiddenModalExpired","Conversation","title","dispatch","page","fanpage","loading","store","loadingStore","token","auth","loadingAuth","isValidToken","setIsValidToken","visible","setVisible","hiddenModalExpired","setValueHidden","handleCancelPopup","handleBuyPackage","window","open","URL_STORE","getPackages","packages","_id","pkgsActive","filter","item","active","handleSocialLogin","response","service","accessToken","error","loginFacebook","data","title_page","callApiCheckToken","storeId","fbPageId","fbObjectId","width","flex","overflow","maxWidth","padding","textAlign","marginBottom"],"mappings":"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","sourcesContent":["import { HomeOutlined } from '@ant-design/icons';\nimport { Button, Col, message, Modal, Row, Tooltip } from 'antd';\nimport { push } from 'connected-react-router';\nimport React, { FC, useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getPackagesActive } from '../../api/billing-api';\nimport { validateToken } from '../../api/fanpage';\nimport { IPackage } from '../../collections/billing';\nimport { LoginFacebookBtn } from '../../components';\nimport ExpiredStore from '../../components/expired-store';\nimport constants from '../../constants';\nimport { CustomerLayout } from '../../layout';\nimport { loginActionWithService } from '../../reducers/authState/authAction';\nimport { IAuthState } from '../../reducers/authState/authReducer';\nimport { IFacebookState } from '../../reducers/fanpageState/fanpageReducer';\nimport { IStoreState } from '../../reducers/storeState/storeReducer';\nimport { checkRestrictAction } from '../../utils/get-time';\nimport { useNotification } from '../customer/notfication-context';\nimport ConversationCustomer from './conversation-customer';\nimport ConversationDetail from './conversation-detail';\nimport CoversationList from './conversation-list';\nimport './style.less';\nimport TabPages from './tab-pages';\nimport useHiddenModalExpired from '../../hooks/use-hidden-modal-expired';\n\nconst Conversation: FC = (): JSX.Element => {\n    const { title } = useNotification();\n    const dispatch = useDispatch();\n\n    const page = useSelector(({ fanpage }: { fanpage: IFacebookState }) => fanpage.page);\n    const loading = useSelector(({ fanpage }: { fanpage: IFacebookState }) => fanpage.loading);\n    const store = useSelector(({ store }: { store: IStoreState }) => store.store);\n    const loadingStore = useSelector(({ store }: { store: IStoreState }) => store.loading);\n    const token: any = useSelector(({ auth }: { auth: IAuthState }) => auth.token);\n    const loadingAuth: boolean = useSelector(({ auth }: { auth: IAuthState }) => auth.loading);\n\n    const [isValidToken, setIsValidToken] = useState(true);\n    const [visible, setVisible] = useState(false);\n    const { hiddenModalExpired, setValueHidden } = useHiddenModalExpired();\n\n    const handleCancelPopup = () => {\n        setVisible(false);\n        dispatch(push('/customer/conversation'));\n        setValueHidden('true');\n    };\n\n    const handleBuyPackage = () => {\n        window.open(`${constants.URL_STORE}setting/billings/list`, '_blank');\n    };\n\n    const getPackages = async () => {\n        const packages: IPackage[] = await getPackagesActive(store._id);\n        const pkgsActive = packages.filter((item: any) => item.active);\n        setVisible(checkRestrictAction(pkgsActive));\n    };\n\n    const handleSocialLogin = (response: any, service?: string): void => {\n        const { accessToken } = response;\n        if (accessToken) {\n            dispatch(loginActionWithService({ accessToken }, service));\n        } else {\n            message.error('Đăng nhập không thành công.');\n        }\n    };\n\n    const loginFacebook = (data: any) => {\n        handleSocialLogin(data, 'facebook');\n    };\n\n    const title_page = `${title} Conversation`;\n\n    useEffect(() => {\n        if (!loading && !loadingAuth && !loadingStore && page) {\n            const callApiCheckToken = async () => {\n                try {\n                    await validateToken({\n                        storeId: store._id,\n                        fbPageId: page.fbObjectId,\n                        token: token.accessToken,\n                    });\n                    setIsValidToken(true);\n                } catch (error) {\n                    setIsValidToken(false);\n                }\n            };\n            callApiCheckToken();\n        }\n        getPackages();\n    }, []);\n    return (\n        <>\n            {!hiddenModalExpired && (\n                <ExpiredStore\n                    visible={visible}\n                    onCancel={handleCancelPopup}\n                    onBuyPackage={handleBuyPackage}\n                />\n            )}\n            <CustomerLayout title={title_page}>\n                <div className='conversation'>\n                    <TabPages />\n                    <div className='conversation-main'>\n                        <Row className='content'>\n                            <Col style={{ width: 350 }} className='column conversation-wrap'>\n                                <CoversationList />\n                            </Col>\n                            <Col className='column' style={{ flex: 1, overflow: 'hidden' }}>\n                                <ConversationDetail />\n                            </Col>\n                            <Col style={{ maxWidth: 400, width: '33.33%' }} className='column'>\n                                <ConversationCustomer />\n                            </Col>\n                        </Row>\n                    </div>\n                </div>\n                {!loading && !isValidToken ? (\n                    <Modal\n                        visible={true}\n                        footer={null}\n                        closeIcon={null}\n                        closable={false}\n                        bodyStyle={{ padding: 10, textAlign: 'center' }}\n                        width={400}\n                        title={\n                            <Row align='middle' justify='space-between'>\n                                <Col>Thông báo</Col>\n                                <Col>\n                                    <Tooltip placement='left' title='Trang chủ' color='blue'>\n                                        <Button\n                                            icon={<HomeOutlined />}\n                                            onClick={() => dispatch(push('/'))}\n                                        ></Button>\n                                    </Tooltip>\n                                </Col>\n                            </Row>\n                        }\n                    >\n                        <div style={{ marginBottom: 10 }}>\n                            <span>Facebook token của bạn đã hết hạn hoặc đã bị thay đổi.</span>\n                            <br />\n                            <span>Vui lòng kết nối lại tài khoản facebook của bạn.</span>\n                        </div>\n                        <LoginFacebookBtn\n                            loginFacebook={loginFacebook}\n                            title=' Kết nối lại với facebook'\n                        />\n                    </Modal>\n                ) : (\n                    <></>\n                )}\n            </CustomerLayout>\n        </>\n    );\n};\n\nexport default Conversation;\n"]},"metadata":{},"sourceType":"module"}