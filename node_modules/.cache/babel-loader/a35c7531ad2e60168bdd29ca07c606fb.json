{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/FacebookClient/src/pages/select-pages/table-list-page.tsx\",\n    _s = $RefreshSig$();\n\nimport { Button, Col, message, Row, Table } from 'antd';\nimport { push } from 'connected-react-router';\nimport { get, maxBy, some } from 'lodash';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { EBillingPackageType, getPackagesActive } from '../../api/billing-api';\nimport { loadConversation } from '../../api/conversation-api';\nimport { updatePageStatus } from '../../api/fanpage';\nimport { LoginFacebookBtn } from '../../components';\nimport { BaseLayout } from '../../layout';\nimport { loginActionWithService } from '../../reducers/authState/authAction';\nimport { loadFanpageAction } from '../../reducers/fanpageState/fanpageAction';\nimport ModalLoadData from './modal-load-data';\nimport './style.less';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst size = 'large';\n/**\n * 1. Load page\n * 2. Select page\n * 3. Subscribe page\n */\n\nfunction TableListPages() {\n  _s();\n\n  const token = useSelector(state => state.auth.token);\n  const store = useSelector(state => state.store.store);\n  const pagesData = useSelector(({\n    fanpage\n  }) => fanpage.allPages);\n  const arrPage = Object.keys(pagesData).map(keyName => {\n    return { ...pagesData[keyName],\n      key: pagesData[keyName].fbObjectId\n    };\n  });\n  const [selectedRowKeys, setSelectedRowKeys] = useState(arrPage.map(item => {\n    if (item.active) {\n      return item.fbObjectId;\n    }\n\n    return;\n  }).filter(item => !!item));\n  const [loading, setLoading] = useState(false);\n  const [loading_sub, setLoadingSub] = useState(false);\n  const [pages, selectPages] = useState(arrPage);\n  const [period, setPeriod] = useState();\n  const [selectRows, setSelectRows] = useState([]);\n  const [checkYealyPackage, setCheckYealyPackage] = useState(false);\n  const yearly = 12;\n  const yearlyPackage = 10;\n  const monthPackage = 5;\n\n  const handleFindPackageType = packages => {\n    let selectedRows = [];\n    packages.filter(element => {\n      if (element.packageType & EBillingPackageType.Omni || element.packageType & EBillingPackageType.Trial || element.packageType & EBillingPackageType.Facebook) selectedRows.push(element);\n    });\n    return maxBy(selectedRows, 'period');\n  };\n\n  const getPackages = async () => {\n    var _handleFindPackageTyp;\n\n    const packages = await getPackagesActive(store._id);\n    const periodPackage = (_handleFindPackageTyp = handleFindPackageType(packages)) === null || _handleFindPackageTyp === void 0 ? void 0 : _handleFindPackageTyp.period;\n    setPeriod(periodPackage);\n  };\n\n  useEffect(() => {\n    getPackages();\n  }, []);\n  useEffect(() => {\n    const checkYealyPackage = period >= yearly && selectRows.length === yearlyPackage || period < yearly && selectRows.length === monthPackage ? true : false;\n    setCheckYealyPackage(checkYealyPackage);\n  }, [selectRows, period]);\n\n  const hancleCheckYearlyPackage = record => {\n    if (period && (period >= yearly && selectRows.length === yearlyPackage || period < yearly && selectRows.length === monthPackage) && !some(selectRows, record)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const dispatch = useDispatch();\n\n  const handleSubscride = async () => {\n    try {\n      setLoadingSub(true);\n      const activeFbPageIds = selectedRowKeys;\n      delete store.activePage;\n      const inactiveFbPageIds = [];\n      arrPage.map(item => {\n        if (item.active && !activeFbPageIds.includes(item.fbObjectId)) {\n          inactiveFbPageIds.push(item.fbObjectId);\n        }\n      });\n\n      for (const fbPageId of activeFbPageIds) {\n        const infoPage = arrPage.find(item => item.fbObjectId === fbPageId);\n        await updatePageStatus({\n          fbPageId,\n          payload: {\n            active: true\n          },\n          storeId: store._id,\n          token: token.accessToken\n        }).catch(err => {\n          if (get(err, 'response.data.message') === 'DUPLICATE_ACTIVE_PAGE') {\n            message.error(`Fanpage ${infoPage.name} đã được sử dụng trên tài khoản khác!`);\n          } else {\n            message.error(`Kích hoạt fanpage ${infoPage.name} thất bại!`);\n          }\n        });\n      }\n\n      for (const fbPageId of inactiveFbPageIds) {\n        const infoPage = arrPage.find(item => item.fbObjectId === fbPageId);\n        await updatePageStatus({\n          fbPageId,\n          payload: {\n            active: false\n          },\n          storeId: store._id,\n          token: token.accessToken\n        }).catch(err => message.error(`Vô hiệu hóa fanpage ${infoPage.name} thất bại!`));\n      }\n\n      await loadConversation({\n        storeId: store._id,\n        token: token.accessToken,\n        fbPageIds: activeFbPageIds\n      });\n      await setLoadingSub(false);\n      await dispatch(loadFanpageAction());\n      await dispatch(push('/customer/conversation'));\n      await message.success('Đã đồng bộ dữ liệu');\n    } catch (error) {\n      message.error('Đã có lỗi xảy ra!');\n      setLoadingSub(false);\n    }\n  };\n\n  const columns = [{\n    title: /*#__PURE__*/_jsxDEV(\"b\", {\n      children: \"T\\xEAn fanpage\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 20\n    }, this),\n    dataIndex: 'name'\n  }];\n\n  const selectRow = record => {\n    const newSelectedRowKeys = [...selectedRowKeys];\n\n    if (newSelectedRowKeys.indexOf(record.key) >= 0) {\n      newSelectedRowKeys.splice(newSelectedRowKeys.indexOf(record.key), 1);\n    } else {\n      newSelectedRowKeys.push(record.key);\n    }\n\n    let selectedRows = [];\n    newSelectedRowKeys.forEach(x => {\n      pages.filter(element => {\n        if (element.key === x) selectedRows.push(element);\n      });\n    });\n    setSelectRows(selectedRows);\n    setSelectedRowKeys(newSelectedRowKeys);\n  };\n\n  const onSelectedRowKeysChange = (newSelectedRowKeys, selectedRows) => {\n    setSelectedRowKeys(newSelectedRowKeys);\n    setSelectRows(selectedRows);\n  };\n\n  const handleSocialLogin = (response, service) => {\n    const {\n      accessToken\n    } = response;\n\n    if (accessToken) {\n      dispatch(loginActionWithService({\n        accessToken\n      }, service));\n    } else {\n      message.error('Đăng nhập không thành công.');\n    }\n  };\n\n  const loginFacebook = data => {\n    handleSocialLogin(data, 'facebook');\n  };\n\n  return /*#__PURE__*/_jsxDEV(BaseLayout, {\n    title: \"Ch\\u1ECDn fanpage\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page-wrap\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header-title-active\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"title\",\n          children: \"Ch\\u1ECDn fanpage c\\u1EA7n qu\\u1EA3n l\\xFD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: checkYealyPackage ? '' : 'hidden-sub-header',\n          children: \"\\u0110\\xE3 ch\\u1ECDn t\\u1ED1i \\u0111a s\\u1ED1 page!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Table, {\n        columns: columns,\n        onRow: record => {\n          return {\n            onClick: () => selectRow(record)\n          };\n        },\n        rowSelection: {\n          selectedRowKeys,\n          onChange: (selectedRowKeys, selectedRows) => {\n            onSelectedRowKeysChange(selectedRowKeys, selectedRows);\n          },\n          getCheckboxProps: record => ({\n            disabled: hancleCheckYearlyPackage(record)\n          })\n        },\n        dataSource: pages,\n        pagination: false,\n        loading: loading,\n        rowClassName: record => hancleCheckYearlyPackage(record) && 'disabled-row'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Row, {\n        gutter: 15,\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 12,\n          style: {\n            marginTop: 15\n          },\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            block: true,\n            size: size,\n            type: \"primary\",\n            onClick: handleSubscride,\n            loading: loading_sub,\n            disabled: selectedRowKeys.length === 0,\n            children: \"Truy c\\u1EADp\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 12,\n          style: {\n            marginTop: 15\n          },\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/customer/conversation\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              size: size,\n              block: true,\n              children: \"Tr\\u1EDF l\\u1EA1i\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Row, {\n        gutter: 15,\n        children: /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 24,\n          style: {\n            marginTop: 15\n          },\n          children: /*#__PURE__*/_jsxDEV(LoginFacebookBtn, {\n            loginFacebook: loginFacebook,\n            title: \" Nh\\u1EADp th\\xEAm fanpage\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }, this), loading_sub && /*#__PURE__*/_jsxDEV(ModalLoadData, {\n      visible: loading_sub\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 29\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 201,\n    columnNumber: 9\n  }, this);\n}\n\n_s(TableListPages, \"tSam4+tOHsErei7c9/gz2E4FmeY=\", false, function () {\n  return [useSelector, useSelector, useSelector, useDispatch];\n});\n\n_c = TableListPages;\nexport default TableListPages;\n\nvar _c;\n\n$RefreshReg$(_c, \"TableListPages\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/FacebookClient/src/pages/select-pages/table-list-page.tsx"],"names":["Button","Col","message","Row","Table","push","get","maxBy","some","React","useEffect","useState","useDispatch","useSelector","Link","EBillingPackageType","getPackagesActive","loadConversation","updatePageStatus","LoginFacebookBtn","BaseLayout","loginActionWithService","loadFanpageAction","ModalLoadData","size","TableListPages","token","state","auth","store","pagesData","fanpage","allPages","arrPage","Object","keys","map","keyName","key","fbObjectId","selectedRowKeys","setSelectedRowKeys","item","active","filter","loading","setLoading","loading_sub","setLoadingSub","pages","selectPages","period","setPeriod","selectRows","setSelectRows","checkYealyPackage","setCheckYealyPackage","yearly","yearlyPackage","monthPackage","handleFindPackageType","packages","selectedRows","element","packageType","Omni","Trial","Facebook","getPackages","_id","periodPackage","length","hancleCheckYearlyPackage","record","dispatch","handleSubscride","activeFbPageIds","activePage","inactiveFbPageIds","includes","fbPageId","infoPage","find","payload","storeId","accessToken","catch","err","error","name","fbPageIds","success","columns","title","dataIndex","selectRow","newSelectedRowKeys","indexOf","splice","forEach","x","onSelectedRowKeysChange","handleSocialLogin","response","service","loginFacebook","data","onClick","onChange","getCheckboxProps","disabled","marginTop"],"mappings":"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","sourcesContent":["import { Button, Col, message, Row, Table } from 'antd';\nimport { push } from 'connected-react-router';\nimport { get, maxBy, some } from 'lodash';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { EBillingPackageType, getPackagesActive } from '../../api/billing-api';\nimport { loadConversation } from '../../api/conversation-api';\nimport { updatePageStatus } from '../../api/fanpage';\nimport { IPackage } from '../../collections/billing';\nimport { LoginFacebookBtn } from '../../components';\nimport { BaseLayout } from '../../layout';\nimport { loginActionWithService } from '../../reducers/authState/authAction';\nimport { loadFanpageAction } from '../../reducers/fanpageState/fanpageAction';\nimport { IFacebookState } from '../../reducers/fanpageState/fanpageReducer';\nimport ModalLoadData from './modal-load-data';\nimport './style.less';\nconst size = 'large';\n\n/**\n * 1. Load page\n * 2. Select page\n * 3. Subscribe page\n */\n\nfunction TableListPages(): JSX.Element {\n    const token = useSelector((state: any) => state.auth.token);\n    const store = useSelector((state: any) => state.store.store);\n    const pagesData = useSelector(({ fanpage }: { fanpage: IFacebookState }) => fanpage.allPages);\n    const arrPage = Object.keys(pagesData).map((keyName: string) => {\n        return { ...pagesData[keyName], key: pagesData[keyName].fbObjectId };\n    });\n\n    const [selectedRowKeys, setSelectedRowKeys] = useState<any>(\n        arrPage\n            .map((item) => {\n                if (item.active) {\n                    return item.fbObjectId;\n                }\n                return;\n            })\n            .filter((item) => !!item),\n    );\n    const [loading, setLoading] = useState(false);\n    const [loading_sub, setLoadingSub] = useState(false);\n    const [pages, selectPages] = useState(arrPage);\n    const [period, setPeriod] = useState<number>();\n    const [selectRows, setSelectRows] = useState([]);\n    const [checkYealyPackage, setCheckYealyPackage] = useState<boolean>(false);\n    const yearly = 12;\n    const yearlyPackage = 10;\n    const monthPackage = 5;\n\n    const handleFindPackageType = (packages: any) => {\n        let selectedRows: any = [];\n        packages.filter((element: any) => {\n            if (\n                element.packageType & EBillingPackageType.Omni ||\n                element.packageType & EBillingPackageType.Trial ||\n                element.packageType & EBillingPackageType.Facebook\n            )\n                selectedRows.push(element);\n        });\n        return maxBy(selectedRows, 'period');\n    };\n\n    const getPackages = async () => {\n        const packages: IPackage[] = await getPackagesActive(store._id);\n        const periodPackage = handleFindPackageType(packages)?.period;\n        setPeriod(periodPackage);\n    };\n    useEffect(() => {\n        getPackages();\n    }, []);\n\n    useEffect(() => {\n        const checkYealyPackage =\n            (period >= yearly && selectRows.length === yearlyPackage) ||\n            (period < yearly && selectRows.length === monthPackage)\n                ? true\n                : false;\n\n        setCheckYealyPackage(checkYealyPackage);\n    }, [selectRows, period]);\n\n    const hancleCheckYearlyPackage = (record: any) => {\n        if (\n            period &&\n            ((period >= yearly && selectRows.length === yearlyPackage) ||\n                (period < yearly && selectRows.length === monthPackage)) &&\n            !some(selectRows, record)\n        ) {\n            return true;\n        }\n\n        return false;\n    };\n\n    const dispatch = useDispatch();\n\n    const handleSubscride = async () => {\n        try {\n            setLoadingSub(true);\n            const activeFbPageIds = selectedRowKeys;\n            delete store.activePage;\n            const inactiveFbPageIds: string[] = [];\n            arrPage.map((item: any) => {\n                if (item.active && !activeFbPageIds.includes(item.fbObjectId)) {\n                    inactiveFbPageIds.push(item.fbObjectId);\n                }\n            });\n\n            for (const fbPageId of activeFbPageIds) {\n                const infoPage: any = arrPage.find((item: any) => item.fbObjectId === fbPageId);\n                await updatePageStatus({\n                    fbPageId,\n                    payload: { active: true },\n                    storeId: store._id,\n                    token: token.accessToken,\n                }).catch((err) => {\n                    if (get(err, 'response.data.message') === 'DUPLICATE_ACTIVE_PAGE') {\n                        message.error(\n                            `Fanpage ${infoPage.name} đã được sử dụng trên tài khoản khác!`,\n                        );\n                    } else {\n                        message.error(`Kích hoạt fanpage ${infoPage.name} thất bại!`);\n                    }\n                });\n            }\n\n            for (const fbPageId of inactiveFbPageIds) {\n                const infoPage: any = arrPage.find((item: any) => item.fbObjectId === fbPageId);\n                await updatePageStatus({\n                    fbPageId,\n                    payload: { active: false },\n                    storeId: store._id,\n                    token: token.accessToken,\n                }).catch((err) => message.error(`Vô hiệu hóa fanpage ${infoPage.name} thất bại!`));\n            }\n\n            await loadConversation({\n                storeId: store._id,\n                token: token.accessToken,\n                fbPageIds: activeFbPageIds,\n            });\n            await setLoadingSub(false);\n            await dispatch(loadFanpageAction());\n            await dispatch(push('/customer/conversation'));\n            await message.success('Đã đồng bộ dữ liệu');\n        } catch (error) {\n            message.error('Đã có lỗi xảy ra!');\n            setLoadingSub(false);\n        }\n    };\n\n    const columns = [\n        {\n            title: <b>Tên fanpage</b>,\n            dataIndex: 'name',\n        },\n    ];\n\n    const selectRow = (record: any) => {\n        const newSelectedRowKeys = [...selectedRowKeys];\n        if (newSelectedRowKeys.indexOf(record.key) >= 0) {\n            newSelectedRowKeys.splice(newSelectedRowKeys.indexOf(record.key), 1);\n        } else {\n            newSelectedRowKeys.push(record.key);\n        }\n        let selectedRows: any = [];\n        newSelectedRowKeys.forEach((x) => {\n            pages.filter((element) => {\n                if (element.key === x) selectedRows.push(element);\n            });\n        });\n\n        setSelectRows(selectedRows);\n        setSelectedRowKeys(newSelectedRowKeys);\n    };\n    \n\n    const onSelectedRowKeysChange = (newSelectedRowKeys: any, selectedRows: any) => {\n        setSelectedRowKeys(newSelectedRowKeys);\n        setSelectRows(selectedRows);\n    };\n\n    const handleSocialLogin = (response: any, service?: string): void => {\n        const { accessToken } = response;\n        if (accessToken) {\n            dispatch(loginActionWithService({ accessToken }, service));\n        } else {\n            message.error('Đăng nhập không thành công.');\n        }\n    };\n\n    const loginFacebook = (data: any) => {\n        handleSocialLogin(data, 'facebook');\n    };\n\n    return (\n        <BaseLayout title='Chọn fanpage'>\n            <div className='page-wrap'>\n                <div className='header-title-active'>\n                    <h3 className='title'>Chọn fanpage cần quản lý</h3>\n                    <span className={checkYealyPackage ? '' : 'hidden-sub-header'}>\n                        Đã chọn tối đa số page!\n                    </span>\n                </div>\n                <Table\n                    columns={columns}\n                    onRow={(record: any) => {\n                        return {\n                            onClick: () => selectRow(record),\n                        };\n                    }}\n                    rowSelection={{\n                        selectedRowKeys,\n                        onChange: (selectedRowKeys: any, selectedRows: any) => {\n                            onSelectedRowKeysChange(selectedRowKeys, selectedRows);\n                        },\n                        getCheckboxProps: (record) => ({\n                            disabled: hancleCheckYearlyPackage(record),\n                        }),\n                    }}\n                    dataSource={pages}\n                    pagination={false}\n                    loading={loading}\n                    rowClassName={(record) => hancleCheckYearlyPackage(record) && 'disabled-row'}\n                />\n\n                <Row gutter={15}>\n                    <Col xs={24} sm={12} style={{ marginTop: 15 }}>\n                        <Button\n                            block\n                            size={size}\n                            type='primary'\n                            onClick={handleSubscride}\n                            loading={loading_sub}\n                            disabled={selectedRowKeys.length === 0}\n                        >\n                            Truy cập\n                        </Button>\n                    </Col>\n                    <Col xs={24} sm={12} style={{ marginTop: 15 }}>\n                        <Link to='/customer/conversation'>\n                            <Button size={size} block>\n                                Trở lại\n                            </Button>\n                        </Link>\n                    </Col>\n                </Row>\n                <Row gutter={15}>\n                    <Col xs={24} sm={24} style={{ marginTop: 15 }}>\n                        <LoginFacebookBtn\n                            loginFacebook={loginFacebook}\n                            title=' Nhập thêm fanpage'\n                        />\n                    </Col>\n                </Row>\n            </div>\n            {loading_sub && <ModalLoadData visible={loading_sub} />}\n        </BaseLayout>\n    );\n}\n\nexport default TableListPages;\n"]},"metadata":{},"sourceType":"module"}