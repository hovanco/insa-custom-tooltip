{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/scripts/filter-script/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useState, useMemo, memo } from 'react';\nimport { Popover, Button } from 'antd';\nimport FilterItem from './component/filter-item';\nimport { isEqual } from 'lodash';\nimport { changeFilter, loadLivestreams } from '../../../../reducers/livestreamState/livestreamAction';\nimport { DownIcon } from '../../../../assets/icon';\nimport './index.less';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst defaultFilterOptions = [{\n  label: 'Chọn điều kiện lọc',\n  value: 'default',\n  used: false\n}, {\n  label: 'Trạng thái kịch bản',\n  value: 'active',\n  used: false\n}, {\n  label: 'Trạng thái sử dụng',\n  value: 'status',\n  used: false\n}, {\n  label: 'Ngày tạo',\n  value: 'date_created',\n  used: false\n}];\n\nconst FilterScript = props => {\n  _s();\n\n  const dispatch = useDispatch();\n  const startTime = useSelector(state => state.livestream.startTime);\n  const endTime = useSelector(state => state.livestream.endTime);\n  const status = useSelector(state => state.livestream.status);\n  const active = useSelector(state => state.livestream.active);\n  const [filterOptions, setFilterOptions] = useState(defaultFilterOptions);\n  const [filterData, setFilterData] = useState([]);\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  useEffect(() => {\n    let newFilterOptions = defaultFilterOptions;\n    let newFilterData = [];\n\n    if (active !== undefined) {\n      newFilterData.push({\n        key: 'active',\n        value: active\n      });\n      newFilterOptions = newFilterOptions.map(i => {\n        return i.value === 'active' ? { ...i,\n          used: true\n        } : i;\n      });\n    }\n\n    if (status !== undefined) {\n      newFilterData.push({\n        key: 'status',\n        value: status\n      });\n      newFilterOptions = newFilterOptions.map(i => {\n        return i.value === 'status' ? { ...i,\n          used: true\n        } : i;\n      });\n    }\n\n    if (startTime !== undefined || endTime !== undefined) {\n      newFilterData.push({\n        key: 'date_created',\n        value: [startTime, endTime]\n      });\n      newFilterOptions = newFilterOptions.map(i => {\n        return i.value === 'date_created' ? { ...i,\n          used: true\n        } : i;\n      });\n    }\n\n    if (!isEqual(newFilterOptions, filterOptions)) setFilterOptions(newFilterOptions);\n    if (newFilterData.length < 3) newFilterData = [...newFilterData, {\n      key: 'default',\n      value: undefined\n    }];\n    if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n  }, [status, active, startTime, endTime, popoverVisible]);\n\n  const onFilterKeyChange = (prevKey, nextKey) => {\n    let newFilterOptions = filterOptions;\n    let newFilterData = filterData;\n    newFilterOptions = newFilterOptions.map(i => {\n      if (i.value === prevKey) return { ...i,\n        used: false\n      };\n      if (i.value === nextKey) return { ...i,\n        used: true\n      };\n      return i;\n    });\n    newFilterData = newFilterData.map(i => {\n      if (i.key === prevKey) return {\n        key: nextKey,\n        value: undefined\n      };\n      return i;\n    });\n    if (!isEqual(newFilterOptions, filterOptions)) setFilterOptions(newFilterOptions);\n    if (prevKey === defaultFilterOptions[0].value && newFilterData.length < 3) newFilterData = [...newFilterData, {\n      key: 'default',\n      value: undefined\n    }];\n    if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n  };\n\n  const onFilterValueChange = (key, nextValue) => {\n    let newFilterData = filterData;\n    newFilterData = newFilterData.map(i => {\n      if (i.key === key) return { ...i,\n        value: nextValue\n      };\n      return i;\n    });\n    if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n  };\n\n  const onRemoveFilterItem = removedKey => {\n    let newFilterData = filterData;\n    newFilterData = newFilterData.filter(i => i.key !== removedKey);\n    if (newFilterData.length < 3 && newFilterData.filter(i => i.key === 'default').length === 0) newFilterData = [...newFilterData, {\n      key: 'default',\n      value: undefined\n    }];\n    if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n  };\n\n  const onSubmitFilter = async () => {\n    setPopoverVisible(false);\n    let submitFilterData = {\n      status: undefined,\n      startTime: undefined,\n      endTime: undefined,\n      active: undefined\n    };\n    filterData.filter(i => i.key !== defaultFilterOptions[0].value).forEach(filterItemData => {\n      if (filterItemData.key == 'date_created') {\n        submitFilterData['startTime'] = filterItemData.value ? filterItemData.value[0] : undefined;\n        submitFilterData['endTime'] = filterItemData.value ? filterItemData.value[1] : undefined;\n      } else submitFilterData[filterItemData.key] = filterItemData.value;\n    });\n    await dispatch(changeFilter(submitFilterData));\n    dispatch(loadLivestreams());\n  };\n\n  const overlayContent = useMemo(() => /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"advance-script-filter-lead-text\",\n      children: \"Hi\\u1EC3n th\\u1ECB k\\u1ECBch b\\u1EA3n theo: \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"advance-script-filter-items\",\n      children: filterData.map((filterItemData, filterItemIndex) => /*#__PURE__*/_jsxDEV(FilterItem, {\n        data: filterItemData,\n        options: filterOptions,\n        onFilterKeyChange: nextKey => onFilterKeyChange(filterItemData.key, nextKey),\n        onFilterValueChange: onFilterValueChange,\n        onRemoveFilterItem: onRemoveFilterItem\n      }, `filter-item-${filterItemIndex}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 25\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"advance-script-filter-btn\",\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        type: \"primary\",\n        onClick: onSubmitFilter,\n        children: \"L\\u1ECDc\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 143,\n    columnNumber: 13\n  }, this), [filterOptions, filterData]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"advance-script-filter\",\n    children: /*#__PURE__*/_jsxDEV(Popover, {\n      content: overlayContent,\n      trigger: \"click\",\n      placement: \"bottom\",\n      visible: popoverVisible,\n      onVisibleChange: setPopoverVisible,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        className: \"btn-trigger-popover\",\n        children: [\"L\\u1ECDc k\\u1ECBch b\\u1EA3n \", /*#__PURE__*/_jsxDEV(DownIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 34\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 170,\n    columnNumber: 9\n  }, this);\n};\n\n_s(FilterScript, \"VzJS2Fa8PAmE37a4qcjWCU5cxnE=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = FilterScript;\nexport default _c2 = /*#__PURE__*/memo(FilterScript);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"FilterScript\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/scripts/filter-script/index.tsx"],"names":["React","useEffect","useDispatch","useSelector","useState","useMemo","memo","Popover","Button","FilterItem","isEqual","changeFilter","loadLivestreams","DownIcon","defaultFilterOptions","label","value","used","FilterScript","props","dispatch","startTime","state","livestream","endTime","status","active","filterOptions","setFilterOptions","filterData","setFilterData","popoverVisible","setPopoverVisible","newFilterOptions","newFilterData","undefined","push","key","map","i","length","onFilterKeyChange","prevKey","nextKey","onFilterValueChange","nextValue","onRemoveFilterItem","removedKey","filter","onSubmitFilter","submitFilterData","forEach","filterItemData","overlayContent","filterItemIndex"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useState, useMemo, memo } from 'react';\nimport { Popover, Button } from 'antd';\nimport FilterItem from './component/filter-item';\nimport { FilterOptions, FilterData } from './interface';\nimport { isEqual } from 'lodash';\nimport {\n    changeFilter,\n    loadLivestreams,\n} from '../../../../reducers/livestreamState/livestreamAction';\nimport { DownIcon } from '../../../../assets/icon';\n\nimport './index.less';\n\ninterface Props {}\n\nconst defaultFilterOptions: Array<FilterOptions> = [\n    { label: 'Chọn điều kiện lọc', value: 'default', used: false },\n    { label: 'Trạng thái kịch bản', value: 'active', used: false },\n    { label: 'Trạng thái sử dụng', value: 'status', used: false },\n    { label: 'Ngày tạo', value: 'date_created', used: false },\n];\n\nconst FilterScript = (props: Props) => {\n    const dispatch = useDispatch();\n    const startTime: number | undefined = useSelector((state: any) => state.livestream.startTime);\n    const endTime: number | undefined = useSelector((state: any) => state.livestream.endTime);\n    const status: number | undefined = useSelector((state: any) => state.livestream.status);\n    const active: number | undefined = useSelector((state: any) => state.livestream.active);\n    const [filterOptions, setFilterOptions] = useState<Array<FilterOptions>>(defaultFilterOptions);\n    const [filterData, setFilterData] = useState<Array<FilterData>>([]);\n    const [popoverVisible, setPopoverVisible] = useState<boolean>(false);\n\n    useEffect(() => {\n        let newFilterOptions: Array<FilterOptions> = defaultFilterOptions;\n        let newFilterData: Array<FilterData> = [];\n\n        if (active !== undefined) {\n            newFilterData.push({ key: 'active', value: active });\n            newFilterOptions = newFilterOptions.map((i: FilterOptions) => {\n                return i.value === 'active' ? { ...i, used: true } : i;\n            });\n        }\n\n        if (status !== undefined) {\n            newFilterData.push({ key: 'status', value: status });\n            newFilterOptions = newFilterOptions.map((i: FilterOptions) => {\n                return i.value === 'status' ? { ...i, used: true } : i;\n            });\n        }\n\n        if (startTime !== undefined || endTime !== undefined) {\n            newFilterData.push({ key: 'date_created', value: [startTime, endTime] });\n            newFilterOptions = newFilterOptions.map((i: FilterOptions) => {\n                return i.value === 'date_created' ? { ...i, used: true } : i;\n            });\n        }\n\n        if (!isEqual(newFilterOptions, filterOptions)) setFilterOptions(newFilterOptions);\n        if (newFilterData.length < 3)\n            newFilterData = [...newFilterData, { key: 'default', value: undefined }];\n        if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n    }, [status, active, startTime, endTime, popoverVisible]);\n\n    const onFilterKeyChange = (prevKey: string, nextKey: string) => {\n        let newFilterOptions: Array<FilterOptions> = filterOptions;\n        let newFilterData: Array<FilterData> = filterData;\n\n        newFilterOptions = newFilterOptions.map((i) => {\n            if (i.value === prevKey) return { ...i, used: false };\n            if (i.value === nextKey) return { ...i, used: true };\n\n            return i;\n        });\n\n        newFilterData = newFilterData.map((i) => {\n            if (i.key === prevKey) return { key: nextKey, value: undefined };\n\n            return i;\n        });\n\n        if (!isEqual(newFilterOptions, filterOptions)) setFilterOptions(newFilterOptions);\n        if (prevKey === defaultFilterOptions[0].value && newFilterData.length < 3)\n            newFilterData = [...newFilterData, { key: 'default', value: undefined }];\n        if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n    };\n\n    const onFilterValueChange = (key: string, nextValue: any) => {\n        let newFilterData: Array<FilterData> = filterData;\n\n        newFilterData = newFilterData.map((i) => {\n            if (i.key === key) return { ...i, value: nextValue };\n\n            return i;\n        });\n\n        if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n    };\n\n    const onRemoveFilterItem = (removedKey: string) => {\n        let newFilterData: Array<FilterData> = filterData;\n\n        newFilterData = newFilterData.filter((i) => i.key !== removedKey);\n\n        if (\n            newFilterData.length < 3 &&\n            newFilterData.filter((i) => i.key === 'default').length === 0\n        )\n            newFilterData = [...newFilterData, { key: 'default', value: undefined }];\n        if (!isEqual(newFilterData, filterData)) setFilterData(newFilterData);\n    };\n\n    const onSubmitFilter = async () => {\n        setPopoverVisible(false);\n\n        let submitFilterData: any = {\n            status: undefined,\n            startTime: undefined,\n            endTime: undefined,\n            active: undefined,\n        };\n\n        filterData\n            .filter((i) => i.key !== defaultFilterOptions[0].value)\n            .forEach((filterItemData) => {\n                if (filterItemData.key == 'date_created') {\n                    submitFilterData['startTime'] = filterItemData.value\n                        ? filterItemData.value[0]\n                        : undefined;\n                    submitFilterData['endTime'] = filterItemData.value\n                        ? filterItemData.value[1]\n                        : undefined;\n                } else submitFilterData[filterItemData.key] = filterItemData.value;\n            });\n\n        await dispatch(changeFilter(submitFilterData));\n        dispatch(loadLivestreams());\n    };\n\n    const overlayContent = useMemo(\n        () => (\n            <div>\n                <span className='advance-script-filter-lead-text'>Hiển thị kịch bản theo: </span>\n                <div className='advance-script-filter-items'>\n                    {filterData.map((filterItemData: FilterData, filterItemIndex: number) => (\n                        <FilterItem\n                            data={filterItemData}\n                            key={`filter-item-${filterItemIndex}`}\n                            options={filterOptions}\n                            onFilterKeyChange={(nextKey: string) =>\n                                onFilterKeyChange(filterItemData.key, nextKey)\n                            }\n                            onFilterValueChange={onFilterValueChange}\n                            onRemoveFilterItem={onRemoveFilterItem}\n                        />\n                    ))}\n                </div>\n                <div className='advance-script-filter-btn'>\n                    <Button type='primary' onClick={onSubmitFilter}>\n                        Lọc\n                    </Button>\n                </div>\n            </div>\n        ),\n        [filterOptions, filterData]\n    );\n\n    return (\n        <div className='advance-script-filter'>\n            <Popover\n                content={overlayContent}\n                trigger='click'\n                placement='bottom'\n                visible={popoverVisible}\n                onVisibleChange={setPopoverVisible}\n            >\n                <Button className='btn-trigger-popover'>\n                    Lọc kịch bản <DownIcon />\n                </Button>\n            </Popover>\n        </div>\n    );\n};\n\nexport default memo(FilterScript);\n"]},"metadata":{},"sourceType":"module"}