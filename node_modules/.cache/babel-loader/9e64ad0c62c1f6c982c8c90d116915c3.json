{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/script/livestream-customer.tsx\",\n    _s = $RefreshSig$();\n\nimport { Button, Card, Col, Input, Pagination, Row, Tabs, Tag } from 'antd';\nimport { debounce } from 'lodash';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport livestreamApi from '../../../api/livestream-api';\nimport { CloseIcon, SearchIcon } from '../../../assets/icon';\nimport { ConversationType } from '../../../collections/facebook-conversation';\nimport { TagFilter } from '../../../components';\nimport FilterCustomer from './filter-customer';\nimport LivestreamCustomerTable from './livestream-customer-table';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const default_data_filters = [{\n  value: 'phoneNo',\n  title: 'Số điện thoại',\n  filters: [{\n    title: 'Có số điện thoại',\n    isHasPhoneNo: true\n  }, {\n    title: 'Không có số điện thoại',\n    isHasPhoneNo: false\n  }]\n}];\n\nconst TagKeyword = ({\n  keyword,\n  handleSelectKeyWord,\n  isActive,\n  id\n}) => {\n  const color = isActive ? 'blue' : 'default';\n\n  const onClick = () => {\n    handleSelectKeyWord(id, keyword);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"keyword\",\n    children: /*#__PURE__*/_jsxDEV(Tag, {\n      style: {\n        cursor: 'pointer'\n      },\n      color: color,\n      onClick: onClick,\n      children: keyword\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 9\n  }, this);\n};\n\n_c = TagKeyword;\nconst {\n  TabPane\n} = Tabs;\nconst LIMIT = 15;\n\nconst LivestreamCustomer = ({\n  script\n}) => {\n  _s();\n\n  const store = useSelector(state => state.store.store);\n  const [filters, setFilters] = useState([]);\n  const [tab, setTab] = useState('all');\n  const [loading, setLoading] = useState(true);\n  const [customers, setCustomer] = useState([]);\n  const [total, setTotal] = useState(1);\n  const [page, setPage] = useState(1);\n  const [pageSize, setPageSize] = useState(LIMIT);\n  const [text, setText] = useState();\n  const [isHasOrder, setIsHasOrder] = useState(undefined);\n  const [isHasPhoneNo, setIsHasPhoneNo] = useState(undefined);\n  const [idKeywordActive, setIdKeywordActive] = useState();\n  const [textSearch, setTextSearch] = useState();\n\n  const handleSearch = searchText => {\n    const textString = searchText.length > 0 ? searchText : undefined;\n    setText(textString);\n  };\n\n  const handleSearchTimeOut = searchText => {\n    setIdKeywordActive(-1);\n    setTextSearch(searchText);\n    debouncedSearch(searchText);\n  };\n\n  const debouncedSearch = useCallback(debounce(handleSearch, 300), []);\n\n  const handleSelectKeyWord = (id, text) => {\n    if (id === idKeywordActive) {\n      setIdKeywordActive(-1);\n      handleSearch('');\n      setTextSearch('');\n    } else {\n      setIdKeywordActive(id);\n      handleSearch(text);\n      setTextSearch(text);\n    }\n  };\n\n  const changeTab = key => {\n    if (key === 'noOrder') {\n      setIsHasOrder('false');\n    } else if (key === 'hasOrder') {\n      setIsHasOrder('true');\n    } else {\n      setIsHasOrder('undefined');\n    }\n\n    setTab(key);\n  };\n\n  const onChangeTable = pagination => {\n    setPage(Number(pagination.current));\n    setPageSize(Number(pagination.pageSize));\n  };\n\n  const handleFilter = newFilters => {\n    if (['noOrder', 'hasOrder'].includes(tab)) {\n      setFilters([...filters, ...newFilters]);\n    } else {\n      setFilters(newFilters);\n    }\n  };\n\n  const removeFilter = filter => {\n    const newFilters = filters.filter(item => item.value !== filter.value);\n    setFilters(newFilters);\n  };\n\n  const loadCustomers = useCallback(async () => {\n    setLoading(true);\n    const isHasOrderValue = !isHasOrder || isHasOrder === 'undefined' ? undefined : JSON.parse(isHasOrder);\n    const isHasPhoneNoValue = !isHasPhoneNo || isHasPhoneNo === 'undefined' ? undefined : JSON.parse(isHasPhoneNo);\n    const response = await livestreamApi.getCustomerInLivestream({\n      storeId: store._id,\n      scriptId: script._id,\n      fbPageId: script.fbPageId,\n      page,\n      limit: pageSize,\n      isHasOrder: isHasOrderValue,\n      isHasPhoneNo: isHasPhoneNoValue,\n      search: text\n    });\n    setCustomer(response.customerOrders);\n    setTotal(response.total);\n    setLoading(false);\n  }, [isHasOrder, isHasPhoneNo, store._id, script._id, script.fbPageId, page, pageSize, text]);\n\n  const reloadCustomer = () => {\n    loadCustomers();\n  };\n\n  const changePagination = (page, pageSize) => {\n    setPage(page);\n    setPageSize(pageSize || 1);\n  };\n\n  useEffect(() => {\n    const newFilterValue = filters.map(item => item.value_filter);\n\n    if (newFilterValue.length > 0) {\n      newFilterValue.forEach(item => {\n        setIsHasPhoneNo(`${item['isHasPhoneNo']}`);\n        setIsHasOrder(`${item['isHasOrder']}`);\n      });\n    } else {\n      setIsHasPhoneNo('undefined');\n      setIsHasOrder('undefined');\n    }\n  }, [filters]);\n  useEffect(() => {\n    loadCustomers();\n  }, [page, pageSize, isHasOrder, isHasPhoneNo, text]);\n  const filterDataFilterDefault = ['noOrder', 'hasOrder'].includes(tab) ? default_data_filters.filter(item => item.value !== 'order') : default_data_filters;\n  const filterValuetFilters = ['noOrder', 'hasOrder'].includes(tab) ? filters.filter(item => item.value !== 'order') : filters;\n  const renderKeywords = script.keywords.map((item, index) => {\n    return /*#__PURE__*/_jsxDEV(TagKeyword, {\n      keyword: item.keyword,\n      id: index,\n      handleSelectKeyWord: handleSelectKeyWord,\n      isActive: index === idKeywordActive\n    }, item.keyword + index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }, this);\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginBottom: 20\n    },\n    className: \"script-report-cutomer\",\n    children: [/*#__PURE__*/_jsxDEV(Card, {\n      bodyStyle: {\n        padding: 0\n      },\n      style: {\n        borderColor: '#cfd2d4',\n        overflow: 'hidden'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Tabs, {\n        activeKey: tab,\n        onChange: changeTab,\n        tabBarStyle: {\n          padding: '0 20px'\n        },\n        tabBarExtraContent: /*#__PURE__*/_jsxDEV(\"a\", {\n          href: `/customer/conversation?pageId=${script.fbPageId}&postId=${script.fbPageId}_${script.videoId}&type=${ConversationType.Comment}`,\n          target: \"_blank\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            type: \"primary\",\n            children: \"Xem t\\u1EA5t c\\u1EA3 b\\xECnh lu\\u1EADn trong h\\u1ED9i tho\\u1EA1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 25\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(TabPane, {\n          tab: \"T\\u1EA5t c\\u1EA3 b\\xECnh lu\\u1EADn\"\n        }, 'all', false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(TabPane, {\n          tab: \"Ch\\u01B0a \\u0111\\u01B0\\u1EE3c t\\u1EA1o \\u0111\\u01A1n\"\n        }, 'noOrder', false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(TabPane, {\n          tab: \"\\u0110\\xE3 \\u0111\\u01B0\\u1EE3c t\\u1EA1o \\u0111\\u01A1n\"\n        }, 'hasOrder', false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: '20px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Row, {\n            gutter: 15,\n            children: [/*#__PURE__*/_jsxDEV(Col, {\n              span: 4,\n              children: /*#__PURE__*/_jsxDEV(FilterCustomer, {\n                handleFilter: handleFilter,\n                filters: filterValuetFilters,\n                dataDefaultFilter: filterDataFilterDefault,\n                tabName: tab\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              span: 12,\n              children: /*#__PURE__*/_jsxDEV(Input, {\n                onChange: e => handleSearchTimeOut(e.target.value),\n                prefix: /*#__PURE__*/_jsxDEV(SearchIcon, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 244,\n                  columnNumber: 45\n                }, this),\n                value: textSearch,\n                allowClear: true,\n                placeholder: \"Nh\\u1EADp t\\u1EEB kh\\xF3a t\\xECm ki\\u1EBFm\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 242,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              span: 24,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"keywords\",\n                children: renderKeywords\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 25\n          }, this), filters.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginTop: 10\n            },\n            children: filters.map(filter => {\n              const closable = ['noOrder', 'hasOrder'].includes(tab) && filter.value === 'order';\n              return /*#__PURE__*/_jsxDEV(TagFilter, {\n                closable: !closable,\n                closeIcon: /*#__PURE__*/_jsxDEV(CloseIcon, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 264,\n                  columnNumber: 56\n                }, this),\n                onClose: () => removeFilter(filter),\n                children: [filter.title, \": \", filter.value_filter.title]\n              }, filter.value, true, {\n                fileName: _jsxFileName,\n                lineNumber: 262,\n                columnNumber: 41\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(LivestreamCustomerTable, {\n          script: script,\n          customers: customers,\n          loading: loading,\n          total: total,\n          page: page,\n          pageSize: pageSize,\n          onChangeTable: onChangeTable,\n          reloadCustomer: reloadCustomer\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      justify: \"end\",\n      children: /*#__PURE__*/_jsxDEV(Col, {\n        children: /*#__PURE__*/_jsxDEV(Pagination, {\n          total: total,\n          showSizeChanger: true,\n          pageSize: pageSize,\n          onChange: changePagination,\n          style: {\n            marginTop: 20\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 210,\n    columnNumber: 9\n  }, this);\n};\n\n_s(LivestreamCustomer, \"iufMTSSOwTpJfzEJJO5feXwn/0Q=\", false, function () {\n  return [useSelector];\n});\n\n_c2 = LivestreamCustomer;\nexport default LivestreamCustomer;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"TagKeyword\");\n$RefreshReg$(_c2, \"LivestreamCustomer\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/script/livestream-customer.tsx"],"names":["Button","Card","Col","Input","Pagination","Row","Tabs","Tag","debounce","React","useCallback","useEffect","useState","useSelector","livestreamApi","CloseIcon","SearchIcon","ConversationType","TagFilter","FilterCustomer","LivestreamCustomerTable","default_data_filters","value","title","filters","isHasPhoneNo","TagKeyword","keyword","handleSelectKeyWord","isActive","id","color","onClick","cursor","TabPane","LIMIT","LivestreamCustomer","script","store","state","setFilters","tab","setTab","loading","setLoading","customers","setCustomer","total","setTotal","page","setPage","pageSize","setPageSize","text","setText","isHasOrder","setIsHasOrder","undefined","setIsHasPhoneNo","idKeywordActive","setIdKeywordActive","textSearch","setTextSearch","handleSearch","searchText","textString","length","handleSearchTimeOut","debouncedSearch","changeTab","key","onChangeTable","pagination","Number","current","handleFilter","newFilters","includes","removeFilter","filter","item","loadCustomers","isHasOrderValue","JSON","parse","isHasPhoneNoValue","response","getCustomerInLivestream","storeId","_id","scriptId","fbPageId","limit","search","customerOrders","reloadCustomer","changePagination","newFilterValue","map","value_filter","forEach","filterDataFilterDefault","filterValuetFilters","renderKeywords","keywords","index","marginBottom","padding","borderColor","overflow","videoId","Comment","e","target","marginTop","closable"],"mappings":"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","sourcesContent":["import { Button, Card, Col, Input, Pagination, Row, Tabs, Tag } from 'antd';\nimport { TablePaginationConfig } from 'antd/lib/table';\nimport { debounce } from 'lodash';\nimport React, { FC, useCallback, useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport livestreamApi from '../../../api/livestream-api';\nimport { CloseIcon, SearchIcon } from '../../../assets/icon';\nimport { ConversationType } from '../../../collections/facebook-conversation';\nimport { ILivestreamScript } from '../../../collections/livestream-script';\nimport { TagFilter } from '../../../components';\nimport FilterCustomer from './filter-customer';\nimport LivestreamCustomerTable from './livestream-customer-table';\n\nexport interface DataFilterItem {\n    value: string;\n    title: string;\n    hide?: boolean;\n    filters: any[];\n}\n\nexport const default_data_filters: DataFilterItem[] = [\n    {\n        value: 'phoneNo',\n        title: 'Số điện thoại',\n        filters: [\n            {\n                title: 'Có số điện thoại',\n                isHasPhoneNo: true,\n            },\n            {\n                title: 'Không có số điện thoại',\n                isHasPhoneNo: false,\n            },\n        ],\n    },\n];\n\ninterface TabKeywordProps {\n    keyword: string;\n    handleSelectKeyWord: (id: number, keyword: any) => void;\n    isActive: boolean;\n    id: number;\n}\n\nconst TagKeyword: FC<TabKeywordProps> = ({ keyword, handleSelectKeyWord, isActive, id }) => {\n    const color = isActive ? 'blue' : 'default';\n\n    const onClick = () => {\n        handleSelectKeyWord(id, keyword);\n    };\n\n    return (\n        <div className='keyword'>\n            <Tag style={{ cursor: 'pointer' }} color={color} onClick={onClick}>\n                {keyword}\n            </Tag>\n        </div>\n    );\n};\n\ninterface Props {\n    script: ILivestreamScript;\n}\n\nconst { TabPane } = Tabs;\nconst LIMIT = 15;\n\nconst LivestreamCustomer: FC<Props> = ({ script }) => {\n    const store = useSelector((state: any) => state.store.store);\n    const [filters, setFilters] = useState<any[]>([]);\n\n    const [tab, setTab] = useState<string>('all');\n    const [loading, setLoading] = useState(true);\n    const [customers, setCustomer] = useState<any[]>([]);\n    const [total, setTotal] = useState<number>(1);\n    const [page, setPage] = useState<number>(1);\n    const [pageSize, setPageSize] = useState<number>(LIMIT);\n    const [text, setText] = useState<string | undefined>();\n    const [isHasOrder, setIsHasOrder] = useState<string | undefined>(undefined);\n    const [isHasPhoneNo, setIsHasPhoneNo] = useState<string | undefined>(undefined);\n    const [idKeywordActive, setIdKeywordActive] = useState<number>();\n    const [textSearch, setTextSearch] = useState<any>();\n\n    const handleSearch = (searchText: string) => {\n        const textString = searchText.length > 0 ? searchText : undefined;\n        setText(textString);\n    };\n\n    const handleSearchTimeOut = (searchText: string) => {\n        setIdKeywordActive(-1);\n        setTextSearch(searchText);\n        debouncedSearch(searchText);\n    };\n    const debouncedSearch = useCallback(debounce(handleSearch, 300), []);\n\n    const handleSelectKeyWord = (id: number, text: string) => {\n        if (id === idKeywordActive) {\n            setIdKeywordActive(-1);\n            handleSearch('');\n            setTextSearch('');\n        } else {\n            setIdKeywordActive(id);\n            handleSearch(text);\n            setTextSearch(text);\n        }\n    };\n\n    const changeTab = (key: string) => {\n        if (key === 'noOrder') {\n            setIsHasOrder('false');\n        } else if (key === 'hasOrder') {\n            setIsHasOrder('true');\n        } else {\n            setIsHasOrder('undefined');\n        }\n\n        setTab(key);\n    };\n\n    const onChangeTable = (pagination: TablePaginationConfig) => {\n        setPage(Number(pagination.current));\n        setPageSize(Number(pagination.pageSize));\n    };\n\n    const handleFilter = (newFilters: any[]) => {\n        if (['noOrder', 'hasOrder'].includes(tab)) {\n            setFilters([...filters, ...newFilters]);\n        } else {\n            setFilters(newFilters);\n        }\n    };\n\n    const removeFilter = (filter: any) => {\n        const newFilters = filters.filter((item: any) => item.value !== filter.value);\n\n        setFilters(newFilters);\n    };\n\n    const loadCustomers = useCallback(async () => {\n        setLoading(true);\n\n        const isHasOrderValue =\n            !isHasOrder || isHasOrder === 'undefined' ? undefined : JSON.parse(isHasOrder);\n        const isHasPhoneNoValue =\n            !isHasPhoneNo || isHasPhoneNo === 'undefined' ? undefined : JSON.parse(isHasPhoneNo);\n\n        const response = await livestreamApi.getCustomerInLivestream({\n            storeId: store._id,\n            scriptId: script._id,\n            fbPageId: script.fbPageId,\n            page,\n            limit: pageSize,\n            isHasOrder: isHasOrderValue,\n            isHasPhoneNo: isHasPhoneNoValue,\n            search: text,\n        });\n\n        setCustomer(response.customerOrders);\n        setTotal(response.total);\n        setLoading(false);\n    }, [isHasOrder, isHasPhoneNo, store._id, script._id, script.fbPageId, page, pageSize, text]);\n\n    const reloadCustomer = () => {\n        loadCustomers();\n    };\n\n    const changePagination = (page: number, pageSize: number | undefined) => {\n        setPage(page);\n        setPageSize(pageSize || 1);\n    };\n\n    useEffect(() => {\n        const newFilterValue: any[] = filters.map((item: any) => item.value_filter);\n        if (newFilterValue.length > 0) {\n            newFilterValue.forEach((item) => {\n                setIsHasPhoneNo(`${item['isHasPhoneNo']}`);\n                setIsHasOrder(`${item['isHasOrder']}`);\n            });\n        } else {\n            setIsHasPhoneNo('undefined');\n            setIsHasOrder('undefined');\n        }\n    }, [filters]);\n\n    useEffect(() => {\n        loadCustomers();\n    }, [page, pageSize, isHasOrder, isHasPhoneNo, text]);\n\n    const filterDataFilterDefault = ['noOrder', 'hasOrder'].includes(tab)\n        ? default_data_filters.filter((item: any) => item.value !== 'order')\n        : default_data_filters;\n\n    const filterValuetFilters = ['noOrder', 'hasOrder'].includes(tab)\n        ? filters.filter((item: any) => item.value !== 'order')\n        : filters;\n\n    const renderKeywords = script.keywords.map((item: any, index: number) => {\n        return (\n            <TagKeyword\n                keyword={item.keyword}\n                key={item.keyword + index}\n                id={index}\n                handleSelectKeyWord={handleSelectKeyWord}\n                isActive={index === idKeywordActive}\n            />\n        );\n    });\n\n    return (\n        <div style={{ marginBottom: 20 }} className='script-report-cutomer'>\n            <Card bodyStyle={{ padding: 0 }} style={{ borderColor: '#cfd2d4', overflow: 'hidden' }}>\n                <Tabs\n                    activeKey={tab}\n                    onChange={changeTab}\n                    tabBarStyle={{ padding: '0 20px' }}\n                    tabBarExtraContent={\n                        <a\n                            href={`/customer/conversation?pageId=${script.fbPageId}&postId=${script.fbPageId}_${script.videoId}&type=${ConversationType.Comment}`}\n                            target='_blank'\n                        >\n                            <Button type='primary'>Xem tất cả bình luận trong hội thoại</Button>\n                        </a>\n                    }\n                >\n                    <TabPane tab='Tất cả bình luận' key='all'></TabPane>\n                    <TabPane tab='Chưa được tạo đơn' key='noOrder'></TabPane>\n                    <TabPane tab='Đã được tạo đơn' key='hasOrder'></TabPane>\n                </Tabs>\n                <div>\n                    <div style={{ padding: '20px' }}>\n                        <Row gutter={15}>\n                            <Col span={4}>\n                                <FilterCustomer\n                                    handleFilter={handleFilter}\n                                    filters={filterValuetFilters}\n                                    dataDefaultFilter={filterDataFilterDefault}\n                                    tabName={tab}\n                                />\n                            </Col>\n\n                            <Col span={12}>\n                                <Input\n                                    onChange={(e: any) => handleSearchTimeOut(e.target.value)}\n                                    prefix={<SearchIcon />}\n                                    value={textSearch}\n                                    allowClear\n                                    placeholder='Nhập từ khóa tìm kiếm'\n                                />\n                            </Col>\n                            <Col span={24}>\n                                <div className='keywords'>{renderKeywords}</div>\n                            </Col>\n                        </Row>\n\n                        {filters.length > 0 && (\n                            <div style={{ marginTop: 10 }}>\n                                {filters.map((filter: any) => {\n                                    const closable =\n                                        ['noOrder', 'hasOrder'].includes(tab) &&\n                                        filter.value === 'order';\n                                    return (\n                                        <TagFilter\n                                            closable={!closable}\n                                            closeIcon={<CloseIcon />}\n                                            key={filter.value}\n                                            onClose={() => removeFilter(filter)}\n                                        >\n                                            {filter.title}: {filter.value_filter.title}\n                                        </TagFilter>\n                                    );\n                                })}\n                            </div>\n                        )}\n                    </div>\n\n                    <LivestreamCustomerTable\n                        script={script}\n                        customers={customers}\n                        loading={loading}\n                        total={total}\n                        page={page}\n                        pageSize={pageSize}\n                        onChangeTable={onChangeTable}\n                        reloadCustomer={reloadCustomer}\n                    />\n                </div>\n            </Card>\n            <Row justify='end'>\n                <Col>\n                    <Pagination\n                        total={total}\n                        showSizeChanger\n                        pageSize={pageSize}\n                        onChange={changePagination}\n                        style={{ marginTop: 20 }}\n                    />\n                </Col>\n            </Row>\n        </div>\n    );\n};\n\nexport default LivestreamCustomer;\n"]},"metadata":{},"sourceType":"module"}