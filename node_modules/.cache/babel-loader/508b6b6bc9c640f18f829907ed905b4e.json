{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/scripts/switch-active-script.tsx\",\n    _s = $RefreshSig$();\n\nimport { message, Modal, Switch, Tooltip } from 'antd';\nimport React, { useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport livestreamApi from '../../../api/livestream-api';\nimport { updateScript, loadLivestreams } from '../../../reducers/livestreamState/livestreamAction';\nimport { checkActiveAndNotUseScripts } from '../shared';\nimport { EScriptType, EScriptStatus } from '../../../collections/livestream-script';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SwitchActiveScript = ({\n  script\n}) => {\n  _s();\n\n  const dispatch = useDispatch();\n  const store = useSelector(state => state.store.store);\n  const [loading, setLoading] = useState(false);\n  const disabledSwitch = !script.active && script.status !== 0;\n\n  const handleOnChange = async () => {\n    if (script.type === EScriptType.EndedLivestream && !script.videoId) {\n      return message.error('Kịch bản chưa chọn video, hãy bổ sung trước khi kích hoạt');\n    }\n\n    setLoading(true);\n\n    if (script.active && [EScriptStatus.InUse, EScriptStatus.CreatingOrder].includes(script.status)) {\n      Modal.confirm({\n        width: 450,\n        title: 'Bạn có chắc chắn muốn ngừng kịch bản này?',\n        content: 'Kịch bản đang hoạt động sẽ không hoạt động trở lại.',\n        onCancel: () => {\n          setLoading(false);\n        },\n        onOk: () => {\n          changeActiveScript();\n        }\n      });\n    } else if (!script.active) {\n      await checkActiveAndNotUseScripts({\n        fbPageId: script.fbPageId,\n        storeId: store._id,\n        onOk: async () => {\n          await changeActiveScript();\n          dispatch(loadLivestreams());\n        },\n        onCancel: () => setLoading(false)\n      });\n    } else {\n      changeActiveScript();\n    }\n  };\n\n  const changeActiveScript = async () => {\n    await livestreamApi.changeActiveScript({\n      storeId: store._id,\n      fbPageId: script.fbPageId,\n      scriptId: script._id,\n      active: !script.active\n    }).then(() => {\n      setLoading(false);\n      dispatch(updateScript({ ...script,\n        active: !script.active\n      }));\n      message.success(`Đã ${script.active ? 'ngưng kích hoạt' : 'kích hoạt'} ${script.name} thành công`);\n    }).catch(() => {\n      setLoading(false);\n      message.error(`Lỗi thay đổi trạng thái kịch bản`);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Tooltip, {\n    style: {\n      whiteSpace: 'nowrap'\n    },\n    title: disabledSwitch ? 'Không thể thao tác với kịch bản đang tạo đơn hàng hoặc đã kết thúc' : '',\n    children: /*#__PURE__*/_jsxDEV(Switch, {\n      size: \"default\",\n      checked: script.active,\n      onChange: handleOnChange,\n      loading: loading,\n      disabled: disabledSwitch\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 9\n  }, this);\n};\n\n_s(SwitchActiveScript, \"BSe2gFFMrg+/VrfbJB9mnyFeDq0=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = SwitchActiveScript;\nexport default SwitchActiveScript;\n\nvar _c;\n\n$RefreshReg$(_c, \"SwitchActiveScript\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/scripts/switch-active-script.tsx"],"names":["message","Modal","Switch","Tooltip","React","useState","useDispatch","useSelector","livestreamApi","updateScript","loadLivestreams","checkActiveAndNotUseScripts","EScriptType","EScriptStatus","SwitchActiveScript","script","dispatch","store","state","loading","setLoading","disabledSwitch","active","status","handleOnChange","type","EndedLivestream","videoId","error","InUse","CreatingOrder","includes","confirm","width","title","content","onCancel","onOk","changeActiveScript","fbPageId","storeId","_id","scriptId","then","success","name","catch","whiteSpace"],"mappings":"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","sourcesContent":["import { message, Modal, Switch, Tooltip } from 'antd';\nimport React, { useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport livestreamApi from '../../../api/livestream-api';\nimport { updateScript, loadLivestreams } from '../../../reducers/livestreamState/livestreamAction';\nimport { checkActiveAndNotUseScripts } from '../shared';\nimport { EScriptType, EScriptStatus } from '../../../collections/livestream-script';\n\ninterface Props {\n    script: any;\n}\n\nconst SwitchActiveScript = ({ script }: Props) => {\n    const dispatch = useDispatch();\n    const store = useSelector((state: any) => state.store.store);\n    const [loading, setLoading] = useState(false);\n\n    const disabledSwitch = !script.active && script.status !== 0;\n\n    const handleOnChange = async () => {\n        if (script.type === EScriptType.EndedLivestream && !script.videoId) {\n            return message.error('Kịch bản chưa chọn video, hãy bổ sung trước khi kích hoạt');\n        }\n\n        setLoading(true);\n\n        if (\n            script.active &&\n            [EScriptStatus.InUse, EScriptStatus.CreatingOrder].includes(script.status)\n        ) {\n            Modal.confirm({\n                width: 450,\n                title: 'Bạn có chắc chắn muốn ngừng kịch bản này?',\n                content: 'Kịch bản đang hoạt động sẽ không hoạt động trở lại.',\n                onCancel: () => {\n                    setLoading(false);\n                },\n                onOk: () => {\n                    changeActiveScript();\n                },\n            });\n        } else if (!script.active) {\n            await checkActiveAndNotUseScripts({\n                fbPageId: script.fbPageId,\n                storeId: store._id,\n                onOk: async () => {\n                    await changeActiveScript();\n                    dispatch(loadLivestreams());\n                },\n                onCancel: () => setLoading(false),\n            });\n        } else {\n            changeActiveScript();\n        }\n    };\n\n    const changeActiveScript = async () => {\n        await livestreamApi\n            .changeActiveScript({\n                storeId: store._id,\n                fbPageId: script.fbPageId,\n                scriptId: script._id,\n                active: !script.active,\n            })\n            .then(() => {\n                setLoading(false);\n                dispatch(updateScript({ ...script, active: !script.active }));\n                message.success(\n                    `Đã ${script.active ? 'ngưng kích hoạt' : 'kích hoạt'} ${\n                        script.name\n                    } thành công`,\n                );\n            })\n            .catch(() => {\n                setLoading(false);\n                message.error(`Lỗi thay đổi trạng thái kịch bản`);\n            });\n    };\n\n    return (\n        <Tooltip\n            style={{whiteSpace: 'nowrap'}}\n            title={\n                disabledSwitch\n                    ? 'Không thể thao tác với kịch bản đang tạo đơn hàng hoặc đã kết thúc'\n                    : ''\n            }\n        >\n            <Switch\n                size='default'\n                checked={script.active}\n                onChange={handleOnChange}\n                loading={loading}\n                disabled={disabledSwitch}\n            />\n        </Tooltip>\n    );\n};\n\nexport default SwitchActiveScript;\n"]},"metadata":{},"sourceType":"module"}