{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/script-step/btn-save.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { useNewLiveStream } from './context';\nimport { omit } from 'lodash';\nimport livestreamApi from '../../../api/livestream-api';\nimport { checkActiveAndNotUseScripts } from '../shared';\nimport { size } from './index';\nimport { Button, message } from 'antd';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst BtnSave = ({\n  title,\n  active = false,\n  type,\n  script\n}) => {\n  _s();\n\n  const history = useHistory();\n  const [loading, setLoading] = useState(false);\n  const store = useSelector(state => state.store.store);\n  const {\n    livestream,\n    resetLiveStream\n  } = useNewLiveStream();\n\n  const updateScriptLivestream = async data => {\n    try {\n      if (active && !script.active) {\n        await checkActiveAndNotUseScripts({\n          fbPageId: script.fbPageId,\n          storeId: store._id,\n          onOk: () => finalizeUpdatingScript(data),\n          onCancel: () => setLoading(false)\n        });\n      } else {\n        finalizeUpdatingScript(data);\n      }\n    } catch (error) {\n      setLoading(false);\n    }\n  };\n\n  const finalizeUpdatingScript = async (data, options = {\n    updateActive: false\n  }) => {\n    try {\n      await livestreamApi.updateScript({\n        storeId: store._id,\n        fbPageId: script.fbPageId,\n        scriptId: script._id,\n        data: { ...omit(data, ['_id', 'active', 'status', 'storeId', 'fbPageId', 'createdAt', 'updatedAt', 'video', '__v'])\n        }\n      });\n\n      if (active && !script.active) {\n        await livestreamApi.changeActiveScript({\n          storeId: store._id,\n          fbPageId: script.fbPageId,\n          scriptId: script._id,\n          active\n        });\n      }\n\n      message.success('Chỉnh sửa thành công kịch bản');\n      history.push('/customer/livestream/scripts');\n      setLoading(false);\n    } catch (error) {\n      message.error('Chỉnh sửa kịch bản thất bại');\n      setLoading(false);\n    }\n  };\n\n  const createScriptLivestream = async data => {\n    try {\n      if (active) {\n        await checkActiveAndNotUseScripts({\n          fbPageId: data.fbPageId,\n          storeId: store._id,\n          onOk: () => finalizeCreatingScript(data),\n          onCancel: () => setLoading(false)\n        });\n      } else {\n        finalizeCreatingScript(data);\n      }\n    } catch (error) {\n      setLoading(false);\n    }\n  };\n\n  const finalizeCreatingScript = async data => {\n    try {\n      const newScript = await livestreamApi.createLivestream({\n        storeId: store._id,\n        fbPageId: data.fbPageId,\n        data: { ...omit(data, ['fbPageId', 'active'])\n        }\n      });\n\n      if (active) {\n        await livestreamApi.changeActiveScript({\n          storeId: store._id,\n          fbPageId: data.fbPageId,\n          scriptId: newScript._id,\n          active\n        });\n      }\n\n      message.success('Đã tạo thành công kịch bản');\n      resetLiveStream();\n      history.push('/customer/livestream/scripts');\n      setLoading(false);\n    } catch (error) {\n      message.success('Tạo kịch bản thất bại');\n      setLoading(false);\n    }\n  };\n\n  const saveLiveStream = async () => {\n    if (livestream.keywords.length === 0) {\n      message.error('Bạn chưa tạo mẫu từ khóa đặt hàng!');\n    } else {\n      try {\n        setLoading(true);\n        const keywords = livestream.keywords.map(keyword => {\n          const products = keyword.products.map(product => ({\n            productId: script && product.productId ? product.productId._id : product._id,\n            price: product.price\n          }));\n          return {\n            keyword: keyword.keyword,\n            products\n          };\n        });\n        const data = { ...livestream,\n          keywords,\n          active\n        };\n\n        if (script) {\n          updateScriptLivestream(data);\n        } else {\n          createScriptLivestream(data);\n        }\n      } catch (error) {\n        setLoading(false);\n      }\n    }\n  };\n\n  const disabled = livestream.keywords.length === 0 || livestream.type === 1 && !livestream.videoId;\n  return /*#__PURE__*/_jsxDEV(Button, {\n    size: size,\n    type: type,\n    onClick: saveLiveStream,\n    disabled: disabled,\n    loading: loading,\n    children: title\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 174,\n    columnNumber: 9\n  }, this);\n};\n\n_s(BtnSave, \"+0ralaKNsxWdgCu1tu72dhC2lb8=\", false, function () {\n  return [useHistory, useSelector, useNewLiveStream];\n});\n\n_c = BtnSave;\nexport default BtnSave;\n\nvar _c;\n\n$RefreshReg$(_c, \"BtnSave\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/FacebookClient/src/pages/live-stream/script-step/btn-save.tsx"],"names":["React","useState","useSelector","useHistory","useNewLiveStream","omit","livestreamApi","checkActiveAndNotUseScripts","size","Button","message","BtnSave","title","active","type","script","history","loading","setLoading","store","state","livestream","resetLiveStream","updateScriptLivestream","data","fbPageId","storeId","_id","onOk","finalizeUpdatingScript","onCancel","error","options","updateActive","updateScript","scriptId","changeActiveScript","success","push","createScriptLivestream","finalizeCreatingScript","newScript","createLivestream","saveLiveStream","keywords","length","map","keyword","products","product","productId","price","disabled","videoId"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { useNewLiveStream } from './context';\n\nimport { omit } from 'lodash';\nimport livestreamApi from '../../../api/livestream-api';\nimport { checkActiveAndNotUseScripts } from '../shared';\n\nimport { size } from './index';\nimport { Button, message } from 'antd';\n\ninterface Props {\n    title: string;\n    active?: boolean;\n    type?: 'primary' | 'default' | undefined;\n    script?: any;\n}\n\nconst BtnSave = ({ title, active = false, type, script }: Props) => {\n    const history = useHistory();\n    const [loading, setLoading] = useState(false);\n\n    const store = useSelector((state: any) => state.store.store);\n\n    const { livestream, resetLiveStream } = useNewLiveStream();\n\n    const updateScriptLivestream = async (data: any) => {\n        try {\n            if (active && !script.active) {\n                await checkActiveAndNotUseScripts({\n                    fbPageId: script.fbPageId,\n                    storeId: store._id,\n                    onOk: () => finalizeUpdatingScript(data),\n                    onCancel: () => setLoading(false),\n                });\n            } else {\n                finalizeUpdatingScript(data);\n            }\n        } catch (error) {\n            setLoading(false);\n        }\n    };\n\n    const finalizeUpdatingScript = async (\n        data: any,\n        options: { updateActive: boolean } = { updateActive: false }\n    ) => {\n        try {\n            await livestreamApi.updateScript({\n                storeId: store._id,\n                fbPageId: script.fbPageId,\n                scriptId: script._id,\n                data: {\n                    ...omit(data, [\n                        '_id',\n                        'active',\n                        'status',\n                        'storeId',\n                        'fbPageId',\n                        'createdAt',\n                        'updatedAt',\n                        'video',\n                        '__v',\n                    ]),\n                },\n            });\n\n            if (active && !script.active) {\n                await livestreamApi.changeActiveScript({\n                    storeId: store._id,\n                    fbPageId: script.fbPageId,\n                    scriptId: script._id,\n                    active,\n                });\n            }\n\n            message.success('Chỉnh sửa thành công kịch bản');\n\n            history.push('/customer/livestream/scripts');\n            setLoading(false);\n        } catch (error) {\n            message.error('Chỉnh sửa kịch bản thất bại');\n            setLoading(false);\n        }\n    };\n\n    const createScriptLivestream = async (data: any) => {\n        try {\n            if (active) {\n                await checkActiveAndNotUseScripts({\n                    fbPageId: data.fbPageId,\n                    storeId: store._id,\n                    onOk: () => finalizeCreatingScript(data),\n                    onCancel: () => setLoading(false),\n                });\n            } else {\n                finalizeCreatingScript(data);\n            }\n        } catch (error) {\n            setLoading(false);\n        }\n    };\n\n    const finalizeCreatingScript = async (data: any) => {\n        try {\n            const newScript: any = await livestreamApi.createLivestream({\n                storeId: store._id,\n                fbPageId: data.fbPageId,\n                data: { ...omit(data, ['fbPageId', 'active']) },\n            });\n\n            if (active) {\n                await livestreamApi.changeActiveScript({\n                    storeId: store._id,\n                    fbPageId: data.fbPageId,\n                    scriptId: newScript._id,\n                    active,\n                });\n            }\n\n            message.success('Đã tạo thành công kịch bản');\n            resetLiveStream();\n\n            history.push('/customer/livestream/scripts');\n            setLoading(false);\n        } catch (error) {\n            message.success('Tạo kịch bản thất bại');\n            setLoading(false);\n        }\n    };\n\n    const saveLiveStream = async () => {\n        if (livestream.keywords.length === 0) {\n            message.error('Bạn chưa tạo mẫu từ khóa đặt hàng!');\n        } else {\n            try {\n                setLoading(true);\n\n                const keywords = livestream.keywords.map((keyword: any) => {\n                    const products = keyword.products.map((product: any) => ({\n                        productId:\n                            script && product.productId ? product.productId._id : product._id,\n                        price: product.price,\n                    }));\n\n                    return {\n                        keyword: keyword.keyword,\n                        products,\n                    };\n                });\n\n                const data = {\n                    ...livestream,\n                    keywords,\n                    active,\n                };\n\n                if (script) {\n                    updateScriptLivestream(data);\n                } else {\n                    createScriptLivestream(data);\n                }\n            } catch (error) {\n                setLoading(false);\n            }\n        }\n    };\n\n    const disabled =\n        livestream.keywords.length === 0 || (livestream.type === 1 && !livestream.videoId);\n\n    return (\n        <Button\n            size={size}\n            type={type}\n            onClick={saveLiveStream}\n            disabled={disabled}\n            loading={loading}\n        >\n            {title}\n        </Button>\n    );\n};\n\nexport default BtnSave;\n"]},"metadata":{},"sourceType":"module"}